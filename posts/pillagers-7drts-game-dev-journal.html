<h1>Pillagers! 7dRTS Game Development Journal</h1>
<p class="lead">
22 July 2013 - 29 July 2013
</p>
<p>
I have decided to participate in the
<a href="http://www.ludumdare.com/compo/2013/07/05/minild-44-announcement/">7-Day Real Time Strategy Challenge, July 2013 edition</a>.
</p>
<p>
I am working with <a href="http://brokensounds.com/">Michael Weber</a> who will
create sound effects, music, and be in charge of the "atmosphere" of the game.
</p>
<h2 id="day-1">Day 1</h2>
<p>
I am using <a href="https://github.com/superjoe30/chem/">chem</a>,
a canvas-based game engine I made for rapid development occasions 
such as this. It has been working out quite well and I think it has been
playing a large role in my productivity today.
</p>
<p>
The game is codenamed "pillagers". The idea is to mix space physics with
real time strategy and see what comes out.
Instead of creating a carefully planned out base, you will be campaigning
through levels, pillaging for resources.
</p>
<p>That's the idea, anyway. We'll see how it pans out.</p>
<p>
Here's a list of the things that work right now:
</p>
<ul>
  <li>Selecting squads and telling them to move around.</li>
  <li>Ships shoot enemy ships, destroying them when their health reaches 0.</li>
  <li>Scrolling around the map.</li>
  <li>Auto generated parallax background with stars and a planet.</li>
</ul>
<p>
The code is
<a href="https://github.com/superjoe30/pillagers">open source, hosted on GitHub</a>.
It's 941 lines of JavaScript:
</p>
<pre>
   46 src/bullet.js
   33 src/explosion.js
  432 src/main.js
   19 src/militia_ship.js
  241 src/ship_ai.js
  165 src/ship.js
    5 src/uuid.js
  941 total
</pre>
<p>Screenshot of a squad of ships under attack:</p>
<img src="https://s3.amazonaws.com/superjoe/blog-files/pillagers-7drts-game-dev-journal/screenshot-day-1.png" alt=""/>
<p>Short video of me playing around with some elements of the game</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/QQ1jGk5e7o0" frameborder="0" allowfullscreen></iframe>
<p>
It was a fun challenge to write the AI to get the ships to stop at the intended
destinations. As is it's not optimal, but I think that's okay. Maybe later classes
of ships will have better AI.
</p>
<p>
You can actually <a href="http://s3.amazonaws.com/superjoe/temp/pillagers/index.html">play this game right now</a>. Since it's web based, you don't
even have to download anything.
</p>
<p>
Here's what the TODO list looks like currently:
</p>
<ul>
  <li>Edit the main militia ship to have short range.</li>
  <li>Auto targeting enemies should only work when close enough.</li>
  <li>Ability to right click an enemy ship to tell squad to target it.</li>
  <li>Add enemy turrets and ships to level 1.</li>
  <li>Add enemy flag which grants victory when destroyed.</li>
  <li>Add 2nd class of ship which you get some of at beginning of level 1.</li>
  <li>
  Instead of giving the player ships at the beginning, give them cash
  and buildings which they can use to create the ships they want.
  The user will thus be able to choose how many of class 1 and class 2 ships
  they want.
  </li>
  <li>Put instruction label text in level 1 to explain the controls.</li>
  <li>Start planning level 2.</li>
</ul>
<p>
Well, I'm off to bed to get some rest. Looking forward to Day 2!
</p>
<h2 id="day-2">Day 2</h2>
<p>
<a href="http://opengameart.org/">opengameart.org</a> has been very good to
me. I think this will be my new go-to game dev art supply.
So far I've found everything I've wanted on that site, except for a
meteor sprite. Maybe I'll make one and contribute back.
</p>
<p>
Michael made a lazer sound and a ship thrusting sound, and I
added the sound effects to the game.
In addition to that, I made a ton of progress today:
</p>
<ul>
  <li>3pm - draw flags only if selected</li>
  <li>5pm - add another class of ship</li>
  <li>8pm - found out I was using <code>t * a ^ 2 + t * v</code> for
  acceleration instead of <code>a * t ^ 2 + v * t</code>. I fixed
  all the math and made ships arriving at gather points nice and smooth.
  </li>
  <li>9pm - added team colors overlayed on ships</li>
  <li>10pm - gave the Militia ship an electric melee attack</li>
  <li>11pm - gave Militia ships smart attacking AI</li>
  <li>12am - made Ranger ships pursue targets</li>
  <li>2am - added TurretShip and FlagShip</li>
  <li>3am - added support for ships with backwards thrusters</li>
  <li>3am - added move &amp; engage command</li>
  <li>3am - improved ship selection capabilities</li>
  <li>5am - added title screen, credits screen, and game over screen.
    I made it possible to win and lose the game.
  </li>
</ul>
<p>
Here's the title screen:
</p>
<img src="https://s3.amazonaws.com/superjoe/blog-files/pillagers-7drts-game-dev-journal/day-2-titlescreen.png" alt="">
<p>
Here's a screenshot of a battle underway:
</p>
<img src="https://s3.amazonaws.com/superjoe/blog-files/pillagers-7drts-game-dev-journal/day-2-screenshot.png" alt="">
<p>
Battles can get hectic and chaotic, but it is fun to watch it play out.
Here's a video of me demoing a battle:
</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/pnEsHqmNU2c" frameborder="0" allowfullscreen></iframe>
<p>
Again, you can playtest this game in your browser right now using the
<a href="http://s3.amazonaws.com/superjoe/temp/pillagers/index.html">same url</a> as Day 1.
Feel free to give me feedback or advice.
</p>
<p>
I came up with some ideas on what bigger picture gameplay will look like
which I am pretty pleased with.
There will be a bunch of different classes of ships, for example:
</p>
<dl>
  <dt>Militia</dt>
  <dd>Basic cheap unit. Has short range. Agile.
  Actually doesn't shoot lazers, shoots a short range but powerful
  lightning attack out the front. It must resort to charging other
  ships to attack them.
  </dd>
  <dt>Ranger</dt>
  <dd>Short range weak lazers. Less agile. Less defense. In a level, a
   Militia should be able to overtake a Ranger and kill it.
  </dd>
  <dt>Artillery</dt>
  <dd>Slower, shoots big lazers. Slow moving, weak defense.
  </dd>
  <dt>FlagShip</dt>
  <dd>Does not attack. Has high defense. Moves very slowly.
  </dd>
  <dt>Turret</dt>
  <dd>Stationary lazer shooter.
  </dd>
  <dt>Medi</dt>
  <dd>Heals other ships.</dd>
</dl>
<p>
There will be some obvious deficiencies with the ships targeting systems
and AI. These can be helped with upgrades, such as:
</p>
<ul>
  <li>Targeting
  <ul>
    <li>Target the first enemy found (default)</li>
    <li>Target the closest enemy.</li>
    <li>Communicate with others to divide up the targets evenly.</li>
 </ul>
  </li>
  <li>Ranger
  <ul>
    <li>Upgrade range.</li>
    <li>Update bullet count to 3.</li>
    <li>Evasive maneuvers 1.</li>
    <li>Evasive maneuvers 2.</li>
    <li>Smarter aiming.</li>
    <li>Backwards thrusters.</li>
  </ul>
  </li>
  <li>Militia
  <ul>
    <li>Evade lazers.</li>
    <li>Backwards thrusters.</li>
    <li>Smarter aiming.</li>
   </ul>
   </li>
</ul>
<p>
You will start with only a flagship, and as you progress throughout
the campaign, you will start to build up a convoy that gets ever bigger
and more powerful. You'll need it to be bigger and more powerful
to get through later levels, in fact.
</p>
<p>
Here's what's next on the TODO list:
</p>
<ul>
  <li>Build simpler level 1 where you only have to navigate your
  flag ship around meteors.</li>
  <li>Give the player some cash and let them choose to build
  Ranger ships or Militia ships using the Flagship.
  </li>
  <li>Create level 2 where you have to destroy the enemy flagship
  and then fly your flagship through the created portal.</li>
</ul>
<p>
I'm at a pretty good checkpoint right now. I'm calling it a night.
</p>
<h2 id="day-3">Day 3</h2>
<p>
Today Michael gave me the first music track he composed for the game
and I am impressed. 
I am excited to have professional sounding music for a change.
</p>
<p>
That being said, the first thing I did after inserting the music
into the game was program a mute button so that I could keep
listening to techno while I coded.
</p>
<p>
Michael also delivered an electric explosion sound effect that works
perfectly.
</p>
<p>
I mentioned yesterday that I could not find a meteor graphic to use
on <a href="http://opengameart.org/">opengameart.org</a>. I actually
did end up finding
<a href="http://opengameart.org/content/rocks">art that works really well</a>
by searching for "rock".
</p>
<p>
You can see the three rock types in the current spritesheet for the game
which is autogenerated by
<a href="https://github.com/superjoe30/chem/">chem</a>:
</p>
<img src="https://s3.amazonaws.com/superjoe/blog-files/pillagers-7drts-game-dev-journal/day-3-spritesheet.png" alt="" style="background-color: #000000">
<p>
The first thing I did today was create a electrical disintegration
animation, and I'm pretty pleased with the result:
</p>
<img src="https://s3.amazonaws.com/superjoe/blog-files/pillagers-7drts-game-dev-journal/day-3-disintegrate.gif" alt="" style="background-color: #000000">
<p>
I wonder if this is considered good enough to submit to
<a href="http://opengameart.org/">opengameart.org</a>.
</p>
<p>
After I finished that animation, I worked hard and had a productive day:
</p>
<ul>
  <li>3pm - Finished electrical disintegration animation and added sound effect to game.</li>
  <li>3pm - Added in Michael's background music and made it so you can toggle it with M key.</li>
  <li>5pm - Added meteors with collision detection.</li>
  <li>5pm - Fixed "ships rotating for no reason" bug.</li>
  <li>6pm - Inserted a new Level 1 - meteor field that you have to navigate
  through.</li>
  <li>7pm - Created a spastic portal graphic and added it to the level.</li>
  <li>7pm - Fixed navigation bug for ships equipped with backwards thrusters.</li>
  <li>9pm - Fixed scrolling when manual overriding.</li>
  <li>11pm - Added a UI pane when ships are selected.</li>
  <li>12am - Added a mini-map.</li>
  <li>1am - Made it so you can send ships into a portal.</li>
  <li>3am - Made it so selected portal shows what's inside it.</li>
  <li>4am - Added ability to send ships out of a portal.</li>
  <li>5am - Added announcement support.</li>
  <li>6am - Made your convoy show up on the level complete screen.</li>
  <li>6am - Added stats to the level complete screen.</li>
  <li>8am - Finished level complete screen so that you can get to the next level.</li>
</ul>
<p>
The source tree has grown quite a bit since last time I checked, up to
2,704 lines:
</p>
<pre>
   49 src/bullet.js
   77 src/credits_screen.js
   43 src/flag_ship.js
   30 src/fx.js
   73 src/game.js
   34 src/game_over_screen.js
  178 src/level_complete_screen.js
   20 src/main.js
   81 src/meteor.js
   58 src/militia_ship.js
   91 src/physics_object.js
   82 src/portal.js
   60 src/ranger_ship.js
   37 src/sfx.js
  449 src/ship_ai.js
  177 src/ship.js
    7 src/ship_types.js
   57 src/squad.js
  933 src/state.js
   23 src/team.js
  105 src/title_screen.js
   35 src/turret_ship.js
    5 src/uuid.js
 2704 total
</pre>
<p>
I actually feel pretty good about the code organization right now.
I have only had to pause progress and refactor 2-3 times and each time
it was mostly painless.
</p>
<p>
Enough of the technical stuff. Let's see some screenshots.
</p>
<p>
Here's one of the meteor field level you start out in:
</p>
<img src="https://s3.amazonaws.com/superjoe/blog-files/pillagers-7drts-game-dev-journal/day-3-screenshot.png" alt="">
<p>
Here's what it looks like when you finish the level:
</p>
<img src="https://s3.amazonaws.com/superjoe/blog-files/pillagers-7drts-game-dev-journal/day-3-level-complete.png" alt="">
<p>
And here's me giving a walkthrough of the progress made today:
</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/yL-C7-h34qM" frameborder="0" allowfullscreen></iframe>
<p>
My TODO list is getting a bit unruly. I've divided it into "next steps" and
"nice-to-have"s:
</p>
<p>Next steps:
<ul>
  <li>Add text instructions in Level 1 to explain the controls and
  how to beat the level.</li>
  <li>Make it so that you start out the next level with the same fleet that
  you exited with.</li>
  <li>Show your cash in the UI</li>
  <li>Allow you to create ships that you unlock by spending cash.</li>
  <li>Insert a level between 1 and 2 with some attackers. You'll have to build
      some Ranger ships to defend your Flagship.</li>
</ul>
<p>Nice-to-haves:</p>
<ul>
  <li>Figure out why the game slows to a crawl when many ships are
  added and then deleted.</li>
  <li>Experiment with speed cap on ships. (I'm reluctant to do this one -
      I like the idea of high-velocity dogfighting.)</li>
  <li>If Ranger is in range, don't accelerate toward target.</li>
  <li>Fix the thruster sound glitchiness</li>
  <li>Each command should draw something on the screen to indicate
      that something is commanded. (Some commands do this already.)</li>
  <li>When forming a squad, don't assume all ships have the same radius.</li>
</ul>
<p>
And now I must rest. I am exhausted.
</p>
<h2 id="day-4">Day 4</h2>
<p>
It has been wonderful relying only upon circles in this physics engine.
The math is simple and beautiful, and it's easy to write fast code.
Who needs polygons anyway?
</p>

<p>
Today was a good day. Pillagers is now
<a href="http://s3.amazonaws.com/superjoe/temp/pillagers/index.html">actually a game</a>.
What I got done:
</p>
<ul>
  <li>5pm - Added more of Michael's sound effects into the game.</li>
  <li>5pm - Tweaked the physics.</li>
  <li>5pm - Added some cheats to help speed up testing.</li>
  <li>6pm - Added text in Level 1 to explain controls.</li>
  <li>7pm - The game shows how much cash you have.</li>
  <li>10pm - You keep your same fleet when progressing to the next level.</li>
  <li>12am - Added a new Level 2.</li>
  <li>12am - Made unlocking ships work.</li>
  <li>12am - Made it so you get cash from killing enemy ships.</li>
  <li>12am - Tweak the money system.</li>
  <li>1am - Made it so you can scroll and give orders while paused.</li>
  <li>1am - Fixed some game crashes and bugs.</li>
  <li>2am - Modified attacking AI to stay within certain speed limits.
  Makes the game less chaotic.
  </li>
  <li>3am - Added ability to skip tutorial levels.</li>
  <li>4am - Better squad formation.</li>
  <li>4am - Updated the Move &amp; Engage command to be more effective.</li>
  <li>6am - Added Civilian ships and plan out Level 4.</li>
  <li>7am - Add Artillery ship and finish implementing Level 4.</li>
  <li>8am - Fix the crash which happened at the end of the demo below.</li>
</ul>
<p>
Screenshot:
</p>
<img src="https://s3.amazonaws.com/superjoe/blog-files/pillagers-7drts-game-dev-journal/day-4-screenshot.png" alt="">
<p>
Screencast demo:
</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/9nJp5Zr4nQw" frameborder="0" allowfullscreen></iframe>
</p>
<p>
Bed.
</p>
<h2 id="day-5">Day 5</h2>
<p>
I spent a good chunk of the day trying to solve a performance problem.
After approximately 100,000 bullets were fired, the framerate would
drop to an excruciating 16 FPS.
</p>
<p>
I was able to figure it out by using Google Chrome's
<a href="https://developers.google.com/chrome-developer-tools/docs/heap-profiling">heap profiling tool</a>.
Here's what the heap snapshot looked like:
</p>
<img src="https://s3.amazonaws.com/superjoe/blog-files/pillagers-7drts-game-dev-journal/day-5-memory-leak.png">
<p>
I found out that there was a memory leak in the game engine - every time
a sprite was created it called <code>setInterval</code> but it did not
call <code>clearInterval</code> when the sprite was deleted.
Ever since I <a href="https://github.com/superjoe30/chem/commit/900ba7c6f5c27617d9917653ee4d63e4f043374d">fixed the issue</a>, FPS has stayed at a nice
and smooth 60, no matter how many objects are created and destroyed.
</p>
<p>
Here are some other things I got done today:
</p>
<ul>
  <li>9pm - Miscellanous small enhancements.</li>
  <li>11pm - Fixed the performance issue.</li>
  <li>12am - Added the new thruster sound that Michael gave me.</li>
  <li>3am - Added Sandbox Mode.</li>
  <li>4am - Added more features to Sandbox Mode.</li>
  <li>6am - Added Ctrl+A to select all your ships. Also made WASD and J
      work the same as arrow keys and space.</li>
  <li>7am - Added dogfighting mode.</li>
  <li>8am - Added graphics so that ships display their targets when selected.</li>
  <li>8am - Added 2 more dogfighting levels. Enhanced manual piloting of Militia
      ship so that you can use your melee attack.</li>
</ul>
<p>
Here's a screenshot of Sandbox mode:
</p>
<img src="https://s3.amazonaws.com/superjoe/blog-files/pillagers-7drts-game-dev-journal/day-5-sandbox-mode.png">
<p>
Here's me playing through Dogfighting Mode and messing around in
Sandbox Mode a bit:
</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/7bFireOA96Q" frameborder="0" allowfullscreen></iframe>
<p>
I have only 2 days left to work.
The last day will be primarily reserved for gameplay tweaking, bugfixes,
touchups, and testing.
That leaves only 1 more day to make actual progress.
</p>
<p>
These are my goals for tomorrow:
</p>
<ul>
  <li>Add a rotating turret to the flagship.</li>
  <li>Add a civilian to Level 1 and use that to explain the Move command
  vs the Engage command.</li>
  <li>Add a dogfighting level where there is an ongoing battle and you
      have to rack up a certain number of kills to win.</li>
  <li>Add more campaign levels. I reserve the right to ramp up the
      difficulty in the later levels!</li>
  <li>Pan sound effects and volume depending on scroll location</li>
  <li>Add some more ship classes and implement upgrades.</li>
</ul>
<p>
Thanks to the folks in the #7dRTS IRC channel for helping me playtest today.
Specifically Zapa and Orava.
</p>
<h2 id="day-6">Day 6</h2>
<p>
Today I worked on making the level format and core engine more robust. I added a bunch
more dogfighting levels. There are 11 now, and they get pretty crazy at the end.
</p>
<p>
The cool thing about them is that the core game engine does not even know that
you are in "Dogfighting Mode". There's no <code>dogfightingMode</code> variable
that tells the engine that's what you're doing. Instead, the
<a href="https://github.com/superjoe30/pillagers/blob/7d09b2f0842e8962e059ebaa7c05fbf47cff890a/public/text/dogfight0.json">level format</a>
supports trigger conditions, events, and groups, and the logic of dogfighting
is done in the level JSON file.
</p>
<p>
Michael gave me the battle music today as well. It sounds amazing. I made it
so that the game automatically detects when you are entering or exiting a battle and
transitions the music appropriately. I'm pleased with the effect.
</p>
<p>
Here's a list of what I got done today:
</p>
<ul>
  <li>
  12am - Added battle music. The game automatically detects when a battle is
  happening and fades in the battle music, then fades back to normal music
  once the battle is over.
  </li>
  <li>
  1am - Added more dogfighting levels.
  </li>
  <li>
  3am - Worked on making dogfighting levels more fun. You have to try again if you die rather than respawning.
  </li>
  <li>
  4am - Made the Militia ship show the area of attack when you are manually piloting it.
  </li>
  <li>
  6am - Sandbox Mode: Ability to load and save. I was able to use this to build some dogfighting levels.
  </li>
  <li>
  7am - Added more dogfighting levels.
  </li>
</ul>
<p>
I did not accomplish most of what I set out to today. Regardless, I am really happy with Dogfighting Mode
right now. It's almost certainly more fun than Campaign Mode currently.
</p>
<p>
Here's a video of me playing through it:
</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/vye8Sfs3rFM" frameborder="0" allowfullscreen></iframe>
<p>
This version of the game is going to be pretty close to the final one that I submit for 7dRTS.
I will probably only spend about 6-8 more hours on this debugging on Firefox and bugfixing.
I will not be supporting Internet Explorer.
</p>

